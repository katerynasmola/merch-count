<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–¢–µ—Å—Ç Supabase</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-item { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        button { margin: 5px; padding: 5px 10px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Supabase</h1>
    
    <div class="test-item">
        <h3>–¢–µ—Å—Ç 1: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ API</h3>
        <button onclick="testConnection()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</button>
        <div id="connection-log" class="log"></div>
    </div>
    
    <div class="test-item">
        <h3>–¢–µ—Å—Ç 2: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—é</h3>
        <button onclick="testInventory()">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä</button>
        <div id="inventory-log" class="log"></div>
    </div>

    <script>
        function addToLog(elementId, message, type = 'info') {
            const logDiv = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            logDiv.innerHTML += `<span style="color: #666;">[${timestamp}]</span> <span class="${className}">${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function testConnection() {
            const logDiv = document.getElementById('connection-log');
            logDiv.innerHTML = '';
            
            addToLog('connection-log', '–¢–µ—Å—Ç—É—î–º–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Supabase...');
            
            try {
                const response = await fetch('/.netlify/functions/inventory');
                addToLog('connection-log', `HTTP Status: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    addToLog('connection-log', `–î–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö: ${data.source || 'unknown'}`, 'success');
                    addToLog('connection-log', `–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤: ${data.inventory ? data.inventory.length : 0}`, 'success');
                    
                    if (data.inventory && data.inventory.length > 0) {
                        addToLog('connection-log', '–ü–µ—Ä—à—ñ 3 —Ç–æ–≤–∞—Ä–∏:', 'info');
                        data.inventory.slice(0, 3).forEach(item => {
                            addToLog('connection-log', `  - ${item.name} (${item.sku}): ${item.qty} —à—Ç.`, 'info');
                        });
                    }
                } else {
                    const errorText = await response.text();
                    addToLog('connection-log', `–ü–æ–º–∏–ª–∫–∞: ${errorText}`, 'error');
                }
            } catch (error) {
                addToLog('connection-log', `–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: ${error.message}`, 'error');
            }
        }
        
        async function testInventory() {
            const logDiv = document.getElementById('inventory-log');
            logDiv.innerHTML = '';
            
            addToLog('inventory-log', '–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä...');
            
            try {
                const response = await fetch('/.netlify/functions/inventory');
                
                if (response.ok) {
                    const data = await response.json();
                    addToLog('inventory-log', `‚úÖ –£—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${data.inventory.length} —Ç–æ–≤–∞—Ä—ñ–≤`, 'success');
                    
                    // –ì—Ä—É–ø—É—î–º–æ —Ç–æ–≤–∞—Ä–∏ –ø–æ —Ç–∏–ø—É
                    const grouped = {};
                    data.inventory.forEach(item => {
                        if (!grouped[item.sku]) {
                            grouped[item.sku] = [];
                        }
                        grouped[item.sku].push(item);
                    });
                    
                    addToLog('inventory-log', '\nüì¶ –ì—Ä—É–ø–∏ —Ç–æ–≤–∞—Ä—ñ–≤:', 'info');
                    Object.keys(grouped).forEach(sku => {
                        const items = grouped[sku];
                        const totalQty = items.reduce((sum, item) => sum + item.qty, 0);
                        addToLog('inventory-log', `  ${items[0].name} (${sku}): ${totalQty} —à—Ç.`, 'info');
                        
                        if (items.some(item => item.variant)) {
                            items.forEach(item => {
                                if (item.variant) {
                                    addToLog('inventory-log', `    - ${item.variant}: ${item.qty} —à—Ç.`, 'info');
                                }
                            });
                        }
                    });
                } else {
                    const errorText = await response.text();
                    addToLog('inventory-log', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${errorText}`, 'error');
                }
            } catch (error) {
                addToLog('inventory-log', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ç–µ—Å—Ç—É—î–º–æ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', () => {
            addToLog('connection-log', '–°—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.');
        });
    </script>
</body>
</html>

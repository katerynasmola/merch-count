<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Update Function</title>
</head>
<body>
    <h1>–¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü—ñ—ó update-inventory</h1>
    <p>–ü–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –±–ª–æ–∫–Ω–æ—Ç–∞: <span id="currentQty">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span></p>
    <button id="testUpdateBtn">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (qty = 5)</button>
    <button id="checkBtn">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è</button>
    <div id="log"></div>

    <script>
        const API_URL = 'https://merch-count1.netlify.app/.netlify/functions';
        
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}<br>`;
            console.log(message);
        }

        async function getCurrentQty() {
            try {
                const response = await fetch(`${API_URL}/inventory`);
                const data = await response.json();
                const notebook = data.inventory.find(item => item.sku === 'notebook');
                return notebook ? notebook.qty : null;
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ${error.message}`);
                return null;
            }
        }

        async function testUpdate() {
            try {
                log(`üß™ –¢–µ—Å—Ç—É—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–ª–æ–∫–Ω–æ—Ç–∞ –Ω–∞ 5...`);
                const response = await fetch(`${API_URL}/update-inventory`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        updates: [{ sku: 'notebook', variant: 'default', qty: 5 }]
                    })
                });
                const result = await response.json();
                log(`üì§ –í—ñ–¥–ø–æ–≤—ñ–¥—å API: ${JSON.stringify(result)}`);
                
                if (result.success) {
                    log('‚úÖ API –ø–æ–≤–µ—Ä–Ω—É–≤ —É—Å–ø—ñ—Ö!');
                    setTimeout(async () => {
                        const newQty = await getCurrentQty();
                        log(`üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: –ø–æ—Ç–æ—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å = ${newQty}`);
                        if (newQty === 5) {
                            log('üéâ –û–ù–û–í–õ–ï–ù–ù–Ø –ü–†–ê–¶–Æ–Ñ!');
                        } else {
                            log(`‚ùå –û–ù–û–í–õ–ï–ù–ù–Ø –ù–ï –ü–†–ê–¶–Æ–Ñ! –û—á—ñ–∫—É–≤–∞–ª–æ—Å—è 5, –æ—Ç—Ä–∏–º–∞–Ω–æ ${newQty}`);
                        }
                    }, 2000);
                } else {
                    log('‚ùå API –ø–æ–≤–µ—Ä–Ω—É–≤ –ø–æ–º–∏–ª–∫—É!');
                }
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`);
            }
        }

        async function updateDisplay() {
            const qty = await getCurrentQty();
            document.getElementById('currentQty').textContent = qty !== null ? qty : '–ü–æ–º–∏–ª–∫–∞';
            log(`üìä –ü–æ—Ç–æ—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å: ${qty}`);
        }

        document.getElementById('testUpdateBtn').addEventListener('click', testUpdate);
        document.getElementById('checkBtn').addEventListener('click', updateDisplay);

        // –ü–æ—á–∞—Ç–∫–æ–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
        updateDisplay();
    </script>
</body>
</html>

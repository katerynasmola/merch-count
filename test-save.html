<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Тест збереження в Supabase</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-item { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Тест збереження в Supabase</h1>
    
    <div class="test-item">
        <h3>Тест 1: Завантаження поточних даних</h3>
        <button onclick="testLoad()">Завантажити дані</button>
        <div id="load-log" class="log"></div>
    </div>
    
    <div class="test-item">
        <h3>Тест 2: Збереження змін</h3>
        <button onclick="testSave()">Зберегти зміни</button>
        <div id="save-log" class="log"></div>
    </div>
    
    <div class="test-item">
        <h3>Тест 3: Перевірка після збереження</h3>
        <button onclick="testVerify()">Перевірити збереження</button>
        <div id="verify-log" class="log"></div>
    </div>

    <script>
        function addLog(elementId, message, type = 'info') {
            const logDiv = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            logDiv.innerHTML += `<span style="color: #666;">[${timestamp}]</span> <span class="${className}">${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        let currentData = null;
        
        async function testLoad() {
            const logDiv = document.getElementById('load-log');
            logDiv.innerHTML = '';
            
            addLog('load-log', 'Завантажуємо поточні дані...');
            
            try {
                const response = await fetch('http://localhost:3001/inventory');
                if (response.ok) {
                    const data = await response.json();
                    currentData = data;
                    addLog('load-log', `Завантажено ${data.inventory.length} товарів`, 'success');
                    
                    // Знаходимо блокнот
                    const notebook = data.inventory.find(item => item.sku === 'notebook');
                    if (notebook) {
                        addLog('load-log', `Блокнот: ${notebook.qty} шт.`, 'info');
                    }
                } else {
                    addLog('load-log', `Помилка: ${response.status}`, 'error');
                }
            } catch (error) {
                addLog('load-log', `Помилка: ${error.message}`, 'error');
            }
        }
        
        async function testSave() {
            const logDiv = document.getElementById('save-log');
            logDiv.innerHTML = '';
            
            addLog('save-log', 'Відправляємо зміни в Supabase...');
            
            try {
                const updates = [
                    { sku: 'notebook', variant: 'default', qty: 999 }
                ];
                
                const response = await fetch('http://localhost:3001/update-inventory', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ updates })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    addLog('save-log', `Збережено: ${result.updated} товарів`, 'success');
                } else {
                    const errorText = await response.text();
                    addLog('save-log', `Помилка збереження: ${errorText}`, 'error');
                }
            } catch (error) {
                addLog('save-log', `Помилка: ${error.message}`, 'error');
            }
        }
        
        async function testVerify() {
            const logDiv = document.getElementById('verify-log');
            logDiv.innerHTML = '';
            
            addLog('verify-log', 'Перевіряємо збереження...');
            
            try {
                const response = await fetch('http://localhost:3001/inventory');
                if (response.ok) {
                    const data = await response.json();
                    
                    const notebook = data.inventory.find(item => item.sku === 'notebook');
                    if (notebook) {
                        if (notebook.qty === 999) {
                            addLog('verify-log', `✅ Блокнот: ${notebook.qty} шт. - ЗБЕРЕЖЕНО!`, 'success');
                        } else {
                            addLog('verify-log', `❌ Блокнот: ${notebook.qty} шт. - НЕ ЗБЕРЕЖЕНО!`, 'error');
                        }
                    } else {
                        addLog('verify-log', '❌ Блокнот не знайдено!', 'error');
                    }
                } else {
                    addLog('verify-log', `Помилка: ${response.status}`, 'error');
                }
            } catch (error) {
                addLog('verify-log', `Помилка: ${error.message}`, 'error');
            }
        }
        
        // Автоматично завантажуємо дані при завантаженні
        window.addEventListener('load', () => {
            addLog('load-log', 'Сторінка завантажена. Натисніть кнопки для тестування.');
        });
    </script>
</body>
</html>
